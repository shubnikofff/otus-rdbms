# База данных Интернет магазина

Данный проект описывает базу данных типичного интернет магазина.

1. [Бизнес задачи, решаемые базой данных](#бизнес-задачи-решаемые-базой-данных)
2. [Основные сущности](#основные-сущности)
3. [Схема Базы данных](#схема-базы-данных)
4. [Возможные запросы](#возможные-запросы)
5. [Кардинальность полей](#кардинальность-полей)
6. [Дополнительные индексы](#дополнительные-индексы)
7. [Ограничения](#ограничения)

## Бизнес задачи, решаемые базой данных

- Учет доступных к продаже товаров
- Объединение товаров в категории
- Наличие нескольких цен для одного товара в зависимости от поставщика
- Возможность совершать заказы зарегистрированным пользователям (Заказчикам) 
- Поддержка нескольких позиций в заказе с разным количеством товара для каждой позиции
- Поддержка списка адресов доставки
- Применение скидки
- Возможность оставить отзыв к купленному товару
- Хранение мета информации о всех изображениях, используемых в описании товаров, профилях пользователей и отзывах.

## Основные сущности

- ### _Товар_
  - Код
  - Название
  - Описание
  - Производитель
  - Изображения
  - Категории
  - Цены
  - Отзывы

- ### _Цена_
  - Значение
  - Товар 
  - Начальная дата
  - Конечная дата
  - Поставщик (предоставивший товар по данной цене)
  - Доступно товара (по данной цене)
  - Скидка
  
- ### _Скидка_
  - Процент
  - Дата начала
  - Дата окончания
  

- ### _Заказчик_
  - Email
  - Пароль
  - Имя
  - Телефон
  - Адреса доставки
  - Аватар

- ### _Заказ_
  - Номер
  - Дата создания
  - Позиции 
  - Заказчик
  - Статус
  - Адрес доставки
  - Дата доставки
  - Комментарий заказчика

- ### _Позиция заказа_
  - Товар
  - Цена
  - Количество

- ### _Адрес доставки_
  - Страна
  - Город
  - Улица
  - Номер дома
  - Почтовый индекс
  - Описание

- ### _Отзыв_
  - Оценка (численная)
  - Текст
  - Фотографии
  - Товар
  - Заказчик
  - Дата создания

- ### _Изображение_
  - S3 url
  - Сущность (к которой относится изображение)
  - Категория (аватар, фото товара и т.д.)
  - Mime type
  
## Схема Базы данных

![Diagram](diagram.png)

## Возможные запросы
- Регистрация (создание) нового пользователя (заказчика)
- Добавление аватара
- Редактирование данных профиля заказчика  
- Добавление товаров в каталог магазина
- Изменение товаров: редактирование описания, добавление фотографий, назначение категорий
- Назначение цены товарам от разных поставщиков
- Применение скидки
- Поиск товаров по категории, названию, цене, производителю, скидке
- Создание нового заказа
- Изменение статуса существующего заказа
- Создание и редактирование адресов доставки
- Создание отзыва к товару
- Суммарный отчет по заказам за месяц: количество, стоимость, объем
- Отчет по самым продаваемым товарам в определенный период времени
- Отчет по предпочтениям заказчиков: срез заказываемых товаров и профильных данных пользователей
- Отчет по заказчикам: количество новых за выбранный период, количество посещений, количество заказов 

## Кардинальность полей

### _Products_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| code | низкая |
| name | высокая |
| description | средняя |

### _ProductCategories_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| name | средняя |

### _Producers_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| name | средняя |

### _Customers_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| email | средняя |
| name | низкая |
| password | средняя |
| phone | низкая |
| last_visit | низкая |

### _Pictures_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| s3_url | низкая |
| entity_id | высокая |
| category_id | высокая |
| mime_type | низкая |

### _Prices_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| amount | высокая |
| start_date | высокая |
| end_date | высокая |
| product_id | высокая |
| supplier_id | низкая |
| available_quantity | низкая |
| discount_id | средняя |

### _Suppliers_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| name | низкая |

### _Discounts_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| percent | низкая |
| start_date | высокая |
| end_date | высокая |

### _Orders_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| order_number | низкая |
| created_at | средняя |
| customer_comment | низкая |
| customer_id | средняя |
| status_id | средняя |
| delivery_address_id | низкая |
| delivery_date | низкая |

### _OrderStatus_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| name | средняя |

### _DeliveryAddresses_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| country | низкая |
| street | низкая |
| building | низкая |
| zip_code | низкая |
| city | низкая |
| description | низкая |

### _Reviews_

| Поле | Кардинальность |
|----------|-------------|
| id | средняя |
| score | средняя |
| text | низкая |
| customer_id | низкая |
| product_id | средняя |
| created_at | низкая |

## Дополнительные индексы

### _Products_
- **name** - большое количество запросов поиска товаров по имени

### _Pictures_
- **category_id**, **entity_id** - при поиске фотографий сначала учитывается тип сущности (аватар, товар, отзыв), а затем ее id

### _Prices_
- **product_id** - большое количество запросов поиска цен для определенного товара
- **start_date**, **end_date** - практически всегда нас интересуют цены на конкретный период

### _Discounts_
- **start_date**, **end_date** - практически всегда нас интересуют скидки на конкретный период

### _Orders_
- **created_at** - необходимо для составления отчетов по заказам с разбивкой по датам

### _Reviews_
- **product_id** - отзывы релевантны в контексте одного конкретного товара
- **product_id**, **score** - необходимо рассчитывать среднюю оценку (рейтинг) товара

## Ограничения
